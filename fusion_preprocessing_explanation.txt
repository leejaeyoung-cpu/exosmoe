[코드 설명: 3D 퓨전 데이터 생성 (pages/4_🧬_퓨전_전처리.py)]

이 코드는 "3D 퓨전 데이터 생성(Fusion Preprocessing)"을 위한 스트림릿(Streamlit) 페이지의 소스 코드입니다.
핵심 목적은 기존의 2D 세포 이미지를 Cellpose(AI 세포 분할 모델)를 이용해 분석하고, 이를 [원본 이미지 + 세포 마스크 + 세포 윤곽선]이 합쳐진 3차원 데이터(.npy)로 변환하여 AI 학습 성능을 높이는 것입니다.

---

1. 기본 설정 및 라이브러리 로드
   - FusionPreprocessor: src/fusion_prep.py에 구현된 핵심 클래스로, Cellpose 모델을 로드하고 이미지를 처리합니다.
   - DataManager: 데이터 목록(dataset_manifest.csv)을 관리하는 도구입니다.
   - set_page_config: 페이지 제목과 아이콘을 설정합니다.

2. AI 모델 초기화 (캐싱 적용)
   - @st.cache_resource: Cellpose 모델은 로딩 시간이 길기 때문에, 이 데코레이터를 사용하여 한 번만 로딩하고 메모리에 저장해 둡니다.
   - get_fusion_preprocessor_v2: 모델 인스턴스를 반환하는 함수입니다.

3. 탭 1: 단일 이미지 테스트 (Single Image Test)
   - 사용자가 이미지를 한 장 업로드하여 변환 결과를 즉시 확인할 수 있는 기능입니다.
   - st.file_uploader: JPG, PNG, TIF 파일을 업로드받습니다.
   - preprocessor.process_image: 업로드된 이미지를 분석하여 3채널 퓨전 데이터(fused_data)를 생성합니다.
   - 시각화: 생성된 3개의 채널(원본, 마스크, 윤곽선)을 각각 시각화하여 보여줍니다.

4. 탭 2: 전체 데이터셋 변환 (Batch Conversion)
   - 보유한 모든 이미지를 일괄적으로 변환하는 기능입니다.
   - dm.get_manifest(): 등록된 모든 파일 목록을 가져옵니다.
   - ETA (예상 소요 시간) 계산: 처리 속도를 기반으로 남은 시간을 실시간으로 계산하여 사용자에게 알려줍니다.
   - 데이터 저장 및 등록: 변환된 .npy 파일을 저장하고, dataset_manifest.csv에 새로운 데이터로 등록합니다.
     - type은 'image'로 유지하되, 확장자가 .npy인 경우 데이터 로더가 자동으로 3차원 데이터로 인식하도록 설계되어 있습니다.

---
